(()=>{"use strict";const e=[];const t={week:[],today:[],pushToWeek(e){this.week.push(e)},pushToToday(e){this.today.push(e)},pushtoImportant(e){important.push(e)},getWeek(){return this.week},removeWeek(e){let t=this.week.indexOf(e);this.week.splice(t,1)}};function n(e){console.log(e),document.querySelectorAll(".task-container").forEach((e=>e.remove())),e.forEach((e=>o(e)))}function o(e){let t=document.querySelector(".tasks-container"),n=document.createElement("div");n.classList.add("task-container");let o=document.createElement("p");n.appendChild(o),o.classList.add("task-name"),o.innerHTML=e.title;let i=document.createElement("div"),d=document.createElement("p");d.innerHTML=e.dueDate,d.classList.add("task-date"),n.appendChild(d),e.storeDomElement(n),i.classList.add("task-logos");let r=function(){let e=[];for(let t=1;t<=3;t++){let t=document.createElement("span"),n=document.createElement("img");t.appendChild(n),e.push(t)}return e[0].firstElementChild.src="/img/edit.png",e[0].classList.add("edit"),e[2].firstElementChild.src="/img/trash.png",e[2].classList.add("trash"),e[1].firstElementChild.src="/img/info.svg  ",e[1].classList.add("info"),e}();e.storeIcons(r),r.forEach((e=>i.appendChild(e))),n.appendChild(i),t.appendChild(n)}function i(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function r(e){i(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===d(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}function l(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}var a={};function s(){return a}function c(e,t){var n,o,d,a,c,u,p,m;i(1,arguments);var f=s(),h=l(null!==(n=null!==(o=null!==(d=null!==(a=null==t?void 0:t.weekStartsOn)&&void 0!==a?a:null==t||null===(c=t.locale)||void 0===c||null===(u=c.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==d?d:f.weekStartsOn)&&void 0!==o?o:null===(p=f.locale)||void 0===p||null===(m=p.options)||void 0===m?void 0:m.weekStartsOn)&&void 0!==n?n:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var y=r(e),v=y.getDay(),D=(v<h?7:0)+v-h;return y.setDate(y.getDate()-D),y.setHours(0,0,0,0),y}function u(e,t,n){i(2,arguments);var o=c(e,n),d=c(t,n);return o.getTime()===d.getTime()}function p(e){i(1,arguments);var t=r(e);return t.setHours(0,0,0,0),t}function m(e,t){i(2,arguments);var n=p(e),o=p(t);return n.getTime()===o.getTime()}let f="";function h(d,r,l){let a=new FormData(d),s=Object.fromEntries(a),c=s.title,p=s.description,h=s.dueDate,v=s.priority;if("editTask"===r){let e=l.parentFolder;console.log(e.toDofolder),l.editToDo(c,p,h,v),n(e.toDofolder)}else"addTask"===r?function(n,d,r,l,a){let s=new w(n,d,r,l);var c;(function(e){let n=Date.parse(e.dueDate),o="";!function(e,t){return i(1,arguments),u(e,Date.now(),t)}(n)?function(e){return i(1,arguments),m(e,Date.now())}(n)&&(o="today"):o="week","week"===o?(t.pushToWeek(e),e.addDateFolder("week")):"today"===o&&(t().pushToToday(e),e.addDateFolder("today"))})(s),c=s,e.push(c),console.log(e),""!==a?(a.addToFolder(s),a.switchMainDisplayFolder()):function(e){o(e)}(s)}(c,p,h,v,l):function(e){let t=new y(e);f=t,t.newFolderDom(),t.switchMainDisplayFolder()}(c)}class y{toDofolder=[];constructor(e){this.folder=e}setHeader(){document.querySelector(".main-title").textContent=this.folder}newFolderDom(e){this.setHeader(),this.switchMainDisplayFolder(this.toDofolder);const t=document.querySelector(".folders-container");let n=document.createElement("a");n.classList.add("menu-link-item"),n.textContent=this.folder,t.appendChild(n);const o=this;n.addEventListener("click",(function(){o.switchMainDisplayFolder()}))}addToFolder(e){this.toDofolder.push(e),console.log(this.toDofolder),e.addParentFolder(this)}deleteFromFolder(e){let t=this.toDofolder.indexOf(e);this.toDofolder.splice(t,1)}switchMainDisplayFolder(){f=this,console.log(this.toDofolder),n(this.toDofolder),this.setHeader()}switch(){console.log(this.toDofolder)}updateDisplay(){}}const v=document.getElementById("Epopup"),D=document.getElementsByClassName("popup-main");function g(e,t){let n=event.target.id;const o=document.getElementById("popup-header");if(v.style.display="flex","info"===e)return o.textContent="Info",function(e){document.getElementById("form").style.display="none";let t=document.createElement("div");t.classList.add("info-container"),D[0].appendChild(t),t.appendChild(C("Title",e.title)),t.appendChild(C("Description",e.description)),t.appendChild(C("Due Date",e.dueDate)),t.appendChild(C("Priority",e.priority)),t.appendChild(C("Folder",e.parentFolder.folder))}(t),void k("info");"edit"===e&&(o.textContent="Edit",E(["Title","Description","Due Date","Priority"],0,t),k("editTask",t)),"createFolder"==n&&(o.textContent="Create Folder",E(["Title"]),D[0].classList.add("createFolder"),k("createFolder")),"add-task"==n&&(o.textContent="Add task",E(["Title","Description","Due Date","Priority"]),k("addTask"))}function E(e,t,n){const o=document.getElementById("form");let i=n;function d(e,t,n){const i=document.createElement("div");i.classList.add("input-wrapper"),o.appendChild(i);const d=document.createElement("label");d.textContent=e,d.htmlFor=n,i.appendChild(d),i.appendChild(t)}console.log(i),e.map((e=>{if("Title"===e){const t=document.createElement("input");void 0!==i&&(t.value=n.title);const o="title";t.name=o,d(e,t,o)}if("Description"===e){const r=document.createElement("textarea");void 0!==i&&(r.value=n.description),r.name="description",d(e,r)}if("Due Date"===e){const l=document.createElement("input");void 0!==i&&(l.value=n.dueDate),l.name="dueDate",l.type="date",d(e,l)}if("Priority"===e){const a=document.createElement("select");function s(e){let t=document.createElement("option");t.textContent=e,a.appendChild(t)}a.name="priority",s("Low"),s("High"),void 0!==i&&(a.value=n.priority),d(e,a)}}))}function k(e,t){console.log(t);let n=document.createElement("button");n.textContent="Submit",n.classList.add("submit-button"),n.type="submit",n.addEventListener("click",(function(o){o.preventDefault(),"addTask"===e?h(n.form,"addTask",f):"editTask"===e?h(n.form,"editTask",t):(h(n.form,"createFolder"),D[0].classList.remove("createFolder")),d.innerHTML=" ",v.style.display="none"}));let o=document.createElement("button");o.addEventListener("click",(function(e){e.preventDefault();let t=document.querySelector(".info-container");console.log(t);let n=document.getElementById("form");if(void 0!==t&&"none"===n.style.display){const e=document.querySelector(".info-container"),t=document.getElementById("form");console.log(t),e.innerHTML=" ",e.remove(),t.style.display=""}n.innerHTML=" ",v.style.display="none"})),o.textContent="Cancel";let i=document.createElement("div");if(i.appendChild(n),i.appendChild(o),i.classList.add("buttons-container"),"info"===e)return document.querySelector(".info-container").appendChild(i),void n.remove();const d=document.getElementById("form");d.appendChild(i)}function C(e,t){let n=document.createElement("div");n.classList.add("info-item");let o=document.createElement("p"),i=document.createElement("p");if(o.textContent=e,i.textContent=t,"Description"===e){i.classList.add("desc");let e=document.createElement("div");return e.classList.add("desc-container"),e.appendChild(i),n.appendChild(o),n.appendChild(e),n}return n.appendChild(o),n.appendChild(i),n}class w{constructor(e,t,n,o){this.title=e,this.description=t,this.dueDate=n,this.priority=o}storeIcons(e){const t=this;Array.from(e).forEach((e=>e.addEventListener("click",(function(e){let n=event.currentTarget;n.classList.contains("trash")?(t.delete(),t.delete2()):n.classList.contains("edit")?g("edit",t):g("info",t)}))))}storeDomElement(e){this.taskContainer=e}delete(){this.taskContainer.remove()}delete2(){console.log(this.parentFolder),this.parentFolder.deleteFromFolder(this),"week"===this.dateFolder&&t.removeWeek(this)}addParentFolder(e){this.parentFolder=e,console.log(this.parentFolder)}editToDo(e,t,n,o){this.title=e,this.description=t,this.dueDate=n,this.priority=o}addDateFolder(e){this.dateFolder=e}}document.getElementById("add-task").addEventListener("click",g),document.getElementById("createFolder").addEventListener("click",g),function(){const e=document.querySelectorAll(".menu-link-item");console.log("test"),e.forEach((e=>e.addEventListener("click",(e=>{let o=event.target;e.preventDefault(),"Week"===o.textContent&&n(t.getWeek())}))))}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FBUVgsRUFFdEIsS0FDSixDQUNBMUcsZ0JBQWdCWCxHQUNadkIsS0FBS3VCLGNBQWdCQSxDQUV6QixDQUNBNkssU0FDSXBNLEtBQUt1QixjQUFjSixRQUV2QixDQUVBa0wsVUFDSXhMLFFBQVFDLElBQUlkLEtBQUtxSCxjQUNqQnJILEtBQUtxSCxhQUFhMEIsaUJBQWlCL0ksTUFDWCxTQUFwQkEsS0FBS3NNLFlBQ0wzTSxFQUFlVyxXQUFXTixLQUVsQyxDQUVBOEksZ0JBQWdCNUgsR0FDWmxCLEtBQUtxSCxhQUFlbkcsRUFDcEJMLFFBQVFDLElBQUlkLEtBQUtxSCxhQUNyQixDQUVBRSxTQUFTekYsRUFBT3FGLEVBQWFsRixFQUFTbUYsR0FDbENwSCxLQUFLOEIsTUFBUUEsRUFDYjlCLEtBQUttSCxZQUFjQSxFQUNuQm5ILEtBQUtpQyxRQUFVQSxFQUNmakMsS0FBS29ILFNBQVdBLENBQ3BCLENBRUFZLGNBQWNwSCxHQUNWWixLQUFLc00sV0FBYTFMLENBQ3RCLEVDeERrQkcsU0FBU3FJLGVBQWUsWUFDaENQLGlCQUFpQixRQUFTVSxHQUVieEksU0FBU3FJLGVBQWUsZ0JBQ2hDUCxpQkFBaUIsUUFBU1UsR0NOdEMsV0FBZSxNQUFNZ0QsRUFBZXhMLFNBQVNDLGlCQUFpQixtQkFDakVILFFBQVFDLElBQUksUUFDWnlMLEVBQWF0TCxTQUFRcUosR0FBS0EsRUFBRXpCLGlCQUFpQixTQUFVeUIsSUFDbkQsSUFBSWtDLEVBQUloRCxNQUFNQyxPQUNsQmEsRUFBRWlCLGlCQUNvQixTQUFsQmlCLEVBQUUvRCxhQUVGOUgsRUFEYWhCLEVBQWVVLFVBRWhDLEtBRUosQ0RGQW9ILEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b3AtdG9kb2xpc3QvLi9zcmMvZm9sZGVycy5qcyIsIndlYnBhY2s6Ly90b3AtdG9kb2xpc3QvLi9zcmMvZGlzcGxheUZvbGRlcnMuanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG9saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2VzbS9fbGliL3JlcXVpcmVkQXJncy9pbmRleC5qcyIsIndlYnBhY2s6Ly90b3AtdG9kb2xpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvZXNtL3RvRGF0ZS9pbmRleC5qcyIsIndlYnBhY2s6Ly90b3AtdG9kb2xpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvZXNtL19saWIvdG9JbnRlZ2VyL2luZGV4LmpzIiwid2VicGFjazovL3RvcC10b2RvbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9lc20vX2xpYi9kZWZhdWx0T3B0aW9ucy9pbmRleC5qcyIsIndlYnBhY2s6Ly90b3AtdG9kb2xpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvZXNtL3N0YXJ0T2ZXZWVrL2luZGV4LmpzIiwid2VicGFjazovL3RvcC10b2RvbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9lc20vaXNTYW1lV2Vlay9pbmRleC5qcyIsIndlYnBhY2s6Ly90b3AtdG9kb2xpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvZXNtL3N0YXJ0T2ZEYXkvaW5kZXguanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG9saXN0Ly4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2VzbS9pc1NhbWVEYXkvaW5kZXguanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG9saXN0Ly4vc3JjL2dldEZvcm1EYXRhLmpzIiwid2VicGFjazovL3RvcC10b2RvbGlzdC8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9lc20vaXNUaGlzV2Vlay9pbmRleC5qcyIsIndlYnBhY2s6Ly90b3AtdG9kb2xpc3QvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvZXNtL2lzVG9kYXkvaW5kZXguanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG9saXN0Ly4vc3JjL2NyZWF0ZU5ld0ZvbGRlci5qcyIsIndlYnBhY2s6Ly90b3AtdG9kb2xpc3QvLi9zcmMvcG9wdXAuanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG9saXN0Ly4vc3JjL2FkZFRvRG8uanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG9saXN0Ly4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL3RvcC10b2RvbGlzdC8uL3NyYy9zaWRlYmFyLWxpbmtzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRpc3BsYXlGb2xkZXJzIH0gZnJvbSBcIi4vZGlzcGxheUZvbGRlcnNcIjtcbmV4cG9ydCBjb25zdCBtYWluRm9sZGVyID0gWyBdXG5jb25zdCBleHRyYUZvbGRlcnMgPSB7XG5cbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gYWRkVG9NYWluRm9sZGVyKG9rKSB7XG4gICAgXG5cbiAgICBmdW5jdGlvbiBhZGQob2spIHtcbiAgICAgICAgICAgIG1haW5Gb2xkZXIucHVzaChvayk7XG4gICAgICAgICAgICBjaGVja01haW5Gb2xkZXIoKTtcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIGNoZWNrTWFpbkZvbGRlcigpIHtcbiAgICAgICAgY29uc29sZS5sb2cobWFpbkZvbGRlcik7XG4gICAgfVxuXG5cbiAgICByZXR1cm4geyBhZGQsIG1haW5Gb2xkZXIsIGFkZEZvbGRlcn1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZEZvbGRlcihmb2xkZXIpIHtcbiAgICBleHRyYUZvbGRlcnMuZm9sZGVyID0gZm9sZGVyXG4gICAgY29uc29sZS5sb2coZXh0cmFGb2xkZXJzKVxufVxuXG5cblxuZXhwb3J0IGNvbnN0IHNpZGVCYXJGb2xkZXJzID0ge1xuXG4gICAgd2VlazogWyBdLFxuICAgIHRvZGF5OiBbIF0sXG5cbiAgICBwdXNoVG9XZWVrKHRvRG8pIHtcbiAgICAgICAgdGhpcy53ZWVrLnB1c2godG9EbylcbiAgICB9LFxuXG4gICAgcHVzaFRvVG9kYXkodG9Ebykge1xuICAgICAgICB0aGlzLnRvZGF5LnB1c2godG9Ebyk7XG4gICAgfSxcblxuICAgIHB1c2h0b0ltcG9ydGFudCh0b0RvKSB7XG4gICAgICAgIGltcG9ydGFudC5wdXNoKHRvRG8pO1xuICAgIH0sXG4gICAgXG4gICAgZ2V0V2VlaygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2VlaztcbiAgICB9LFxuICAgIFxuICAgIHJlbW92ZVdlZWsoaXRlbSkge1xuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLndlZWsuaW5kZXhPZihpdGVtKTtcbiAgICAgICAgdGhpcy53ZWVrLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxufVxuXG5cbiIsIlxuaW1wb3J0IHsgbWFpbkZvbGRlciB9IGZyb20gXCIuL2ZvbGRlcnNcIjtcblxuXG5leHBvcnQgZnVuY3Rpb24gZGlzcGxheUZvbGRlcnMob2spIHtcblxuICAgICAgICBjcmVhdGVOZWVkZWRFbGVtZW50cyhvaylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRpc3BsYXlTd2l0Y2hGb2xkZXJzKGZvbGRlcikge1xuICAgIGNvbnNvbGUubG9nKGZvbGRlcik7XG4gICAgbGV0IGN1cnJlbnRUYXNrQ29udGFpbmVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGFzay1jb250YWluZXJcIilcbiAgICBjdXJyZW50VGFza0NvbnRhaW5lcnMuZm9yRWFjaChlID0+IGUucmVtb3ZlKCkpO1xuICAgIGZvbGRlci5mb3JFYWNoKGUgPT4gY3JlYXRlTmVlZGVkRWxlbWVudHMoZSkpO1xuXG5cbn1cblxuLyogZnVuY3Rpb24gY3JlYXRlRE9NVGFzaygpIHtcbiAgICBjcmVhdGVOZWVkZWRFbGVtZW50cygpXG59ICovXG5cbmZ1bmN0aW9uIGNyZWF0ZU5lZWRlZEVsZW1lbnRzKGUpIHtcbiAgICBsZXQgdGFza3NDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRhc2tzLWNvbnRhaW5lclwiKVxuICAgIGxldCB0YXNrQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICAgIHRhc2tDb250YWluZXIuY2xhc3NMaXN0LmFkZChcInRhc2stY29udGFpbmVyXCIpXG4gICAgbGV0IHRhc2tOYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIilcbiAgICB0YXNrQ29udGFpbmVyLmFwcGVuZENoaWxkKHRhc2tOYW1lKTtcbiAgICB0YXNrTmFtZS5jbGFzc0xpc3QuYWRkKFwidGFzay1uYW1lXCIpXG4gICAgdGFza05hbWUuaW5uZXJIVE1MID0gZS50aXRsZTtcbiAgICBsZXQgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICAgIGxldCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIilcbiAgICBkYXRlLmlubmVySFRNTCA9IGUuZHVlRGF0ZVxuICAgIGRhdGUuY2xhc3NMaXN0LmFkZChcInRhc2stZGF0ZVwiKTtcbiAgICB0YXNrQ29udGFpbmVyLmFwcGVuZENoaWxkKGRhdGUpO1xuXG4gICAgZS5zdG9yZURvbUVsZW1lbnQodGFza0NvbnRhaW5lcik7XG5cbiAgICBkaXYuY2xhc3NMaXN0LmFkZChcInRhc2stbG9nb3NcIilcblxuICAgIGxldCBzcGFuID0gY3JlYXRlSWNvbnMoKTtcbiAgICBlLnN0b3JlSWNvbnMoc3Bhbik7XG4gICAgc3Bhbi5mb3JFYWNoKGUgPT4gZGl2LmFwcGVuZENoaWxkKGUpKTtcbiAgICB0YXNrQ29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7IFxuICAgIHRhc2tzQ29udGFpbmVyLmFwcGVuZENoaWxkKHRhc2tDb250YWluZXIpO1xuXG5cbiAgICBcblxuXG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUljb25zKCkge1xuICAgIGxldCBhcnJheU9mU3BhbnMgPSBbIF1cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSAzOyBpICsrKSB7XG4gICAgICAgIGxldCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpXG4gICAgICAgIGxldCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xuICAgICAgICBzcGFuLmFwcGVuZENoaWxkKGltZyk7XG4gICAgICAgIGFycmF5T2ZTcGFucy5wdXNoKHNwYW4pO1xuICAgIH1cblxuXG5cbiAgICBhcnJheU9mU3BhbnNbMF0uZmlyc3RFbGVtZW50Q2hpbGQuc3JjID0gXCIvaW1nL2VkaXQucG5nXCJcbiAgICBhcnJheU9mU3BhbnNbMF0uY2xhc3NMaXN0LmFkZChcImVkaXRcIilcbiAgICBhcnJheU9mU3BhbnNbMl0uZmlyc3RFbGVtZW50Q2hpbGQuc3JjID0gXCIvaW1nL3RyYXNoLnBuZ1wiXG4gICAgYXJyYXlPZlNwYW5zWzJdLmNsYXNzTGlzdC5hZGQoXCJ0cmFzaFwiKVxuICAgIGFycmF5T2ZTcGFuc1sxXS5maXJzdEVsZW1lbnRDaGlsZC5zcmMgPSBcIi9pbWcvaW5mby5zdmcgIFwiXG4gICAgYXJyYXlPZlNwYW5zWzFdLmNsYXNzTGlzdC5hZGQoXCJpbmZvXCIpXG4gICAgcmV0dXJuIGFycmF5T2ZTcGFuc1xufSIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlcXVpcmVkQXJncyhyZXF1aXJlZCwgYXJncykge1xuICBpZiAoYXJncy5sZW5ndGggPCByZXF1aXJlZCkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IocmVxdWlyZWQgKyAnIGFyZ3VtZW50JyArIChyZXF1aXJlZCA+IDEgPyAncycgOiAnJykgKyAnIHJlcXVpcmVkLCBidXQgb25seSAnICsgYXJncy5sZW5ndGggKyAnIHByZXNlbnQnKTtcbiAgfVxufSIsImZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IFwiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2ZcIjsgaWYgKHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH1cblxuaW1wb3J0IHJlcXVpcmVkQXJncyBmcm9tIFwiLi4vX2xpYi9yZXF1aXJlZEFyZ3MvaW5kZXguanNcIjtcbi8qKlxuICogQG5hbWUgdG9EYXRlXG4gKiBAY2F0ZWdvcnkgQ29tbW9uIEhlbHBlcnNcbiAqIEBzdW1tYXJ5IENvbnZlcnQgdGhlIGdpdmVuIGFyZ3VtZW50IHRvIGFuIGluc3RhbmNlIG9mIERhdGUuXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBDb252ZXJ0IHRoZSBnaXZlbiBhcmd1bWVudCB0byBhbiBpbnN0YW5jZSBvZiBEYXRlLlxuICpcbiAqIElmIHRoZSBhcmd1bWVudCBpcyBhbiBpbnN0YW5jZSBvZiBEYXRlLCB0aGUgZnVuY3Rpb24gcmV0dXJucyBpdHMgY2xvbmUuXG4gKlxuICogSWYgdGhlIGFyZ3VtZW50IGlzIGEgbnVtYmVyLCBpdCBpcyB0cmVhdGVkIGFzIGEgdGltZXN0YW1wLlxuICpcbiAqIElmIHRoZSBhcmd1bWVudCBpcyBub25lIG9mIHRoZSBhYm92ZSwgdGhlIGZ1bmN0aW9uIHJldHVybnMgSW52YWxpZCBEYXRlLlxuICpcbiAqICoqTm90ZSoqOiAqYWxsKiBEYXRlIGFyZ3VtZW50cyBwYXNzZWQgdG8gYW55ICpkYXRlLWZucyogZnVuY3Rpb24gaXMgcHJvY2Vzc2VkIGJ5IGB0b0RhdGVgLlxuICpcbiAqIEBwYXJhbSB7RGF0ZXxOdW1iZXJ9IGFyZ3VtZW50IC0gdGhlIHZhbHVlIHRvIGNvbnZlcnRcbiAqIEByZXR1cm5zIHtEYXRlfSB0aGUgcGFyc2VkIGRhdGUgaW4gdGhlIGxvY2FsIHRpbWUgem9uZVxuICogQHRocm93cyB7VHlwZUVycm9yfSAxIGFyZ3VtZW50IHJlcXVpcmVkXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIENsb25lIHRoZSBkYXRlOlxuICogY29uc3QgcmVzdWx0ID0gdG9EYXRlKG5ldyBEYXRlKDIwMTQsIDEsIDExLCAxMSwgMzAsIDMwKSlcbiAqIC8vPT4gVHVlIEZlYiAxMSAyMDE0IDExOjMwOjMwXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIENvbnZlcnQgdGhlIHRpbWVzdGFtcCB0byBkYXRlOlxuICogY29uc3QgcmVzdWx0ID0gdG9EYXRlKDEzOTIwOTg0MzAwMDApXG4gKiAvLz0+IFR1ZSBGZWIgMTEgMjAxNCAxMTozMDozMFxuICovXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHRvRGF0ZShhcmd1bWVudCkge1xuICByZXF1aXJlZEFyZ3MoMSwgYXJndW1lbnRzKTtcbiAgdmFyIGFyZ1N0ciA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhcmd1bWVudCk7IC8vIENsb25lIHRoZSBkYXRlXG5cbiAgaWYgKGFyZ3VtZW50IGluc3RhbmNlb2YgRGF0ZSB8fCBfdHlwZW9mKGFyZ3VtZW50KSA9PT0gJ29iamVjdCcgJiYgYXJnU3RyID09PSAnW29iamVjdCBEYXRlXScpIHtcbiAgICAvLyBQcmV2ZW50IHRoZSBkYXRlIHRvIGxvc2UgdGhlIG1pbGxpc2Vjb25kcyB3aGVuIHBhc3NlZCB0byBuZXcgRGF0ZSgpIGluIElFMTBcbiAgICByZXR1cm4gbmV3IERhdGUoYXJndW1lbnQuZ2V0VGltZSgpKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgYXJndW1lbnQgPT09ICdudW1iZXInIHx8IGFyZ1N0ciA9PT0gJ1tvYmplY3QgTnVtYmVyXScpIHtcbiAgICByZXR1cm4gbmV3IERhdGUoYXJndW1lbnQpO1xuICB9IGVsc2Uge1xuICAgIGlmICgodHlwZW9mIGFyZ3VtZW50ID09PSAnc3RyaW5nJyB8fCBhcmdTdHIgPT09ICdbb2JqZWN0IFN0cmluZ10nKSAmJiB0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICBjb25zb2xlLndhcm4oXCJTdGFydGluZyB3aXRoIHYyLjAuMC1iZXRhLjEgZGF0ZS1mbnMgZG9lc24ndCBhY2NlcHQgc3RyaW5ncyBhcyBkYXRlIGFyZ3VtZW50cy4gUGxlYXNlIHVzZSBgcGFyc2VJU09gIHRvIHBhcnNlIHN0cmluZ3MuIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2RhdGUtZm5zL2RhdGUtZm5zL2Jsb2IvbWFzdGVyL2RvY3MvdXBncmFkZUd1aWRlLm1kI3N0cmluZy1hcmd1bWVudHNcIik7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG5cbiAgICAgIGNvbnNvbGUud2FybihuZXcgRXJyb3IoKS5zdGFjayk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBEYXRlKE5hTik7XG4gIH1cbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiB0b0ludGVnZXIoZGlydHlOdW1iZXIpIHtcbiAgaWYgKGRpcnR5TnVtYmVyID09PSBudWxsIHx8IGRpcnR5TnVtYmVyID09PSB0cnVlIHx8IGRpcnR5TnVtYmVyID09PSBmYWxzZSkge1xuICAgIHJldHVybiBOYU47XG4gIH1cblxuICB2YXIgbnVtYmVyID0gTnVtYmVyKGRpcnR5TnVtYmVyKTtcblxuICBpZiAoaXNOYU4obnVtYmVyKSkge1xuICAgIHJldHVybiBudW1iZXI7XG4gIH1cblxuICByZXR1cm4gbnVtYmVyIDwgMCA/IE1hdGguY2VpbChudW1iZXIpIDogTWF0aC5mbG9vcihudW1iZXIpO1xufSIsInZhciBkZWZhdWx0T3B0aW9ucyA9IHt9O1xuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRPcHRpb25zKCkge1xuICByZXR1cm4gZGVmYXVsdE9wdGlvbnM7XG59XG5leHBvcnQgZnVuY3Rpb24gc2V0RGVmYXVsdE9wdGlvbnMobmV3T3B0aW9ucykge1xuICBkZWZhdWx0T3B0aW9ucyA9IG5ld09wdGlvbnM7XG59IiwiaW1wb3J0IHRvRGF0ZSBmcm9tIFwiLi4vdG9EYXRlL2luZGV4LmpzXCI7XG5pbXBvcnQgdG9JbnRlZ2VyIGZyb20gXCIuLi9fbGliL3RvSW50ZWdlci9pbmRleC5qc1wiO1xuaW1wb3J0IHJlcXVpcmVkQXJncyBmcm9tIFwiLi4vX2xpYi9yZXF1aXJlZEFyZ3MvaW5kZXguanNcIjtcbmltcG9ydCB7IGdldERlZmF1bHRPcHRpb25zIH0gZnJvbSBcIi4uL19saWIvZGVmYXVsdE9wdGlvbnMvaW5kZXguanNcIjtcbi8qKlxuICogQG5hbWUgc3RhcnRPZldlZWtcbiAqIEBjYXRlZ29yeSBXZWVrIEhlbHBlcnNcbiAqIEBzdW1tYXJ5IFJldHVybiB0aGUgc3RhcnQgb2YgYSB3ZWVrIGZvciB0aGUgZ2l2ZW4gZGF0ZS5cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFJldHVybiB0aGUgc3RhcnQgb2YgYSB3ZWVrIGZvciB0aGUgZ2l2ZW4gZGF0ZS5cbiAqIFRoZSByZXN1bHQgd2lsbCBiZSBpbiB0aGUgbG9jYWwgdGltZXpvbmUuXG4gKlxuICogQHBhcmFtIHtEYXRlfE51bWJlcn0gZGF0ZSAtIHRoZSBvcmlnaW5hbCBkYXRlXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIC0gYW4gb2JqZWN0IHdpdGggb3B0aW9ucy5cbiAqIEBwYXJhbSB7TG9jYWxlfSBbb3B0aW9ucy5sb2NhbGU9ZGVmYXVsdExvY2FsZV0gLSB0aGUgbG9jYWxlIG9iamVjdC4gU2VlIFtMb2NhbGVde0BsaW5rIGh0dHBzOi8vZGF0ZS1mbnMub3JnL2RvY3MvTG9jYWxlfVxuICogQHBhcmFtIHswfDF8MnwzfDR8NXw2fSBbb3B0aW9ucy53ZWVrU3RhcnRzT249MF0gLSB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGRheSBvZiB0aGUgd2VlayAoMCAtIFN1bmRheSlcbiAqIEByZXR1cm5zIHtEYXRlfSB0aGUgc3RhcnQgb2YgYSB3ZWVrXG4gKiBAdGhyb3dzIHtUeXBlRXJyb3J9IDEgYXJndW1lbnQgcmVxdWlyZWRcbiAqIEB0aHJvd3Mge1JhbmdlRXJyb3J9IGBvcHRpb25zLndlZWtTdGFydHNPbmAgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDZcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gVGhlIHN0YXJ0IG9mIGEgd2VlayBmb3IgMiBTZXB0ZW1iZXIgMjAxNCAxMTo1NTowMDpcbiAqIGNvbnN0IHJlc3VsdCA9IHN0YXJ0T2ZXZWVrKG5ldyBEYXRlKDIwMTQsIDgsIDIsIDExLCA1NSwgMCkpXG4gKiAvLz0+IFN1biBBdWcgMzEgMjAxNCAwMDowMDowMFxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBJZiB0aGUgd2VlayBzdGFydHMgb24gTW9uZGF5LCB0aGUgc3RhcnQgb2YgdGhlIHdlZWsgZm9yIDIgU2VwdGVtYmVyIDIwMTQgMTE6NTU6MDA6XG4gKiBjb25zdCByZXN1bHQgPSBzdGFydE9mV2VlayhuZXcgRGF0ZSgyMDE0LCA4LCAyLCAxMSwgNTUsIDApLCB7IHdlZWtTdGFydHNPbjogMSB9KVxuICogLy89PiBNb24gU2VwIDAxIDIwMTQgMDA6MDA6MDBcbiAqL1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzdGFydE9mV2VlayhkaXJ0eURhdGUsIG9wdGlvbnMpIHtcbiAgdmFyIF9yZWYsIF9yZWYyLCBfcmVmMywgX29wdGlvbnMkd2Vla1N0YXJ0c09uLCBfb3B0aW9ucyRsb2NhbGUsIF9vcHRpb25zJGxvY2FsZSRvcHRpbywgX2RlZmF1bHRPcHRpb25zJGxvY2FsLCBfZGVmYXVsdE9wdGlvbnMkbG9jYWwyO1xuXG4gIHJlcXVpcmVkQXJncygxLCBhcmd1bWVudHMpO1xuICB2YXIgZGVmYXVsdE9wdGlvbnMgPSBnZXREZWZhdWx0T3B0aW9ucygpO1xuICB2YXIgd2Vla1N0YXJ0c09uID0gdG9JbnRlZ2VyKChfcmVmID0gKF9yZWYyID0gKF9yZWYzID0gKF9vcHRpb25zJHdlZWtTdGFydHNPbiA9IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy53ZWVrU3RhcnRzT24pICE9PSBudWxsICYmIF9vcHRpb25zJHdlZWtTdGFydHNPbiAhPT0gdm9pZCAwID8gX29wdGlvbnMkd2Vla1N0YXJ0c09uIDogb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX29wdGlvbnMkbG9jYWxlID0gb3B0aW9ucy5sb2NhbGUpID09PSBudWxsIHx8IF9vcHRpb25zJGxvY2FsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9vcHRpb25zJGxvY2FsZSRvcHRpbyA9IF9vcHRpb25zJGxvY2FsZS5vcHRpb25zKSA9PT0gbnVsbCB8fCBfb3B0aW9ucyRsb2NhbGUkb3B0aW8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9vcHRpb25zJGxvY2FsZSRvcHRpby53ZWVrU3RhcnRzT24pICE9PSBudWxsICYmIF9yZWYzICE9PSB2b2lkIDAgPyBfcmVmMyA6IGRlZmF1bHRPcHRpb25zLndlZWtTdGFydHNPbikgIT09IG51bGwgJiYgX3JlZjIgIT09IHZvaWQgMCA/IF9yZWYyIDogKF9kZWZhdWx0T3B0aW9ucyRsb2NhbCA9IGRlZmF1bHRPcHRpb25zLmxvY2FsZSkgPT09IG51bGwgfHwgX2RlZmF1bHRPcHRpb25zJGxvY2FsID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2RlZmF1bHRPcHRpb25zJGxvY2FsMiA9IF9kZWZhdWx0T3B0aW9ucyRsb2NhbC5vcHRpb25zKSA9PT0gbnVsbCB8fCBfZGVmYXVsdE9wdGlvbnMkbG9jYWwyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZGVmYXVsdE9wdGlvbnMkbG9jYWwyLndlZWtTdGFydHNPbikgIT09IG51bGwgJiYgX3JlZiAhPT0gdm9pZCAwID8gX3JlZiA6IDApOyAvLyBUZXN0IGlmIHdlZWtTdGFydHNPbiBpcyBiZXR3ZWVuIDAgYW5kIDYgX2FuZF8gaXMgbm90IE5hTlxuXG4gIGlmICghKHdlZWtTdGFydHNPbiA+PSAwICYmIHdlZWtTdGFydHNPbiA8PSA2KSkge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCd3ZWVrU3RhcnRzT24gbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDYgaW5jbHVzaXZlbHknKTtcbiAgfVxuXG4gIHZhciBkYXRlID0gdG9EYXRlKGRpcnR5RGF0ZSk7XG4gIHZhciBkYXkgPSBkYXRlLmdldERheSgpO1xuICB2YXIgZGlmZiA9IChkYXkgPCB3ZWVrU3RhcnRzT24gPyA3IDogMCkgKyBkYXkgLSB3ZWVrU3RhcnRzT247XG4gIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSAtIGRpZmYpO1xuICBkYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICByZXR1cm4gZGF0ZTtcbn0iLCJpbXBvcnQgc3RhcnRPZldlZWsgZnJvbSBcIi4uL3N0YXJ0T2ZXZWVrL2luZGV4LmpzXCI7XG5pbXBvcnQgcmVxdWlyZWRBcmdzIGZyb20gXCIuLi9fbGliL3JlcXVpcmVkQXJncy9pbmRleC5qc1wiO1xuXG4vKipcbiAqIEBuYW1lIGlzU2FtZVdlZWtcbiAqIEBjYXRlZ29yeSBXZWVrIEhlbHBlcnNcbiAqIEBzdW1tYXJ5IEFyZSB0aGUgZ2l2ZW4gZGF0ZXMgaW4gdGhlIHNhbWUgd2VlayAoYW5kIG1vbnRoIGFuZCB5ZWFyKT9cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFyZSB0aGUgZ2l2ZW4gZGF0ZXMgaW4gdGhlIHNhbWUgd2VlayAoYW5kIG1vbnRoIGFuZCB5ZWFyKT9cbiAqXG4gKiBAcGFyYW0ge0RhdGV8TnVtYmVyfSBkYXRlTGVmdCAtIHRoZSBmaXJzdCBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0ge0RhdGV8TnVtYmVyfSBkYXRlUmlnaHQgLSB0aGUgc2Vjb25kIGRhdGUgdG8gY2hlY2tcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gLSBhbiBvYmplY3Qgd2l0aCBvcHRpb25zLlxuICogQHBhcmFtIHtMb2NhbGV9IFtvcHRpb25zLmxvY2FsZT1kZWZhdWx0TG9jYWxlXSAtIHRoZSBsb2NhbGUgb2JqZWN0LiBTZWUgW0xvY2FsZV17QGxpbmsgaHR0cHM6Ly9kYXRlLWZucy5vcmcvZG9jcy9Mb2NhbGV9XG4gKiBAcGFyYW0gezB8MXwyfDN8NHw1fDZ9IFtvcHRpb25zLndlZWtTdGFydHNPbj0wXSAtIHRoZSBpbmRleCBvZiB0aGUgZmlyc3QgZGF5IG9mIHRoZSB3ZWVrICgwIC0gU3VuZGF5KVxuICogQHJldHVybnMge0Jvb2xlYW59IHRoZSBkYXRlcyBhcmUgaW4gdGhlIHNhbWUgd2VlayAoYW5kIG1vbnRoIGFuZCB5ZWFyKVxuICogQHRocm93cyB7VHlwZUVycm9yfSAyIGFyZ3VtZW50cyByZXF1aXJlZFxuICogQHRocm93cyB7UmFuZ2VFcnJvcn0gYG9wdGlvbnMud2Vla1N0YXJ0c09uYCBtdXN0IGJlIGJldHdlZW4gMCBhbmQgNlxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBBcmUgMzEgQXVndXN0IDIwMTQgYW5kIDQgU2VwdGVtYmVyIDIwMTQgaW4gdGhlIHNhbWUgd2Vlaz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzU2FtZVdlZWsobmV3IERhdGUoMjAxNCwgNywgMzEpLCBuZXcgRGF0ZSgyMDE0LCA4LCA0KSlcbiAqIC8vPT4gdHJ1ZVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBJZiB3ZWVrIHN0YXJ0cyB3aXRoIE1vbmRheSxcbiAqIC8vIGFyZSAzMSBBdWd1c3QgMjAxNCBhbmQgNCBTZXB0ZW1iZXIgMjAxNCBpbiB0aGUgc2FtZSB3ZWVrP1xuICogY29uc3QgcmVzdWx0ID0gaXNTYW1lV2VlayhuZXcgRGF0ZSgyMDE0LCA3LCAzMSksIG5ldyBEYXRlKDIwMTQsIDgsIDQpLCB7XG4gKiAgIHdlZWtTdGFydHNPbjogMVxuICogfSlcbiAqIC8vPT4gZmFsc2VcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQXJlIDEgSmFudWFyeSAyMDE0IGFuZCAxIEphbnVhcnkgMjAxNSBpbiB0aGUgc2FtZSB3ZWVrP1xuICogY29uc3QgcmVzdWx0ID0gaXNTYW1lV2VlayhuZXcgRGF0ZSgyMDE0LCAwLCAxKSwgbmV3IERhdGUoMjAxNSwgMCwgMSkpXG4gKiAvLz0+IGZhbHNlXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGlzU2FtZVdlZWsoZGlydHlEYXRlTGVmdCwgZGlydHlEYXRlUmlnaHQsIG9wdGlvbnMpIHtcbiAgcmVxdWlyZWRBcmdzKDIsIGFyZ3VtZW50cyk7XG4gIHZhciBkYXRlTGVmdFN0YXJ0T2ZXZWVrID0gc3RhcnRPZldlZWsoZGlydHlEYXRlTGVmdCwgb3B0aW9ucyk7XG4gIHZhciBkYXRlUmlnaHRTdGFydE9mV2VlayA9IHN0YXJ0T2ZXZWVrKGRpcnR5RGF0ZVJpZ2h0LCBvcHRpb25zKTtcbiAgcmV0dXJuIGRhdGVMZWZ0U3RhcnRPZldlZWsuZ2V0VGltZSgpID09PSBkYXRlUmlnaHRTdGFydE9mV2Vlay5nZXRUaW1lKCk7XG59IiwiaW1wb3J0IHRvRGF0ZSBmcm9tIFwiLi4vdG9EYXRlL2luZGV4LmpzXCI7XG5pbXBvcnQgcmVxdWlyZWRBcmdzIGZyb20gXCIuLi9fbGliL3JlcXVpcmVkQXJncy9pbmRleC5qc1wiO1xuLyoqXG4gKiBAbmFtZSBzdGFydE9mRGF5XG4gKiBAY2F0ZWdvcnkgRGF5IEhlbHBlcnNcbiAqIEBzdW1tYXJ5IFJldHVybiB0aGUgc3RhcnQgb2YgYSBkYXkgZm9yIHRoZSBnaXZlbiBkYXRlLlxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUmV0dXJuIHRoZSBzdGFydCBvZiBhIGRheSBmb3IgdGhlIGdpdmVuIGRhdGUuXG4gKiBUaGUgcmVzdWx0IHdpbGwgYmUgaW4gdGhlIGxvY2FsIHRpbWV6b25lLlxuICpcbiAqIEBwYXJhbSB7RGF0ZXxOdW1iZXJ9IGRhdGUgLSB0aGUgb3JpZ2luYWwgZGF0ZVxuICogQHJldHVybnMge0RhdGV9IHRoZSBzdGFydCBvZiBhIGRheVxuICogQHRocm93cyB7VHlwZUVycm9yfSAxIGFyZ3VtZW50IHJlcXVpcmVkXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFRoZSBzdGFydCBvZiBhIGRheSBmb3IgMiBTZXB0ZW1iZXIgMjAxNCAxMTo1NTowMDpcbiAqIGNvbnN0IHJlc3VsdCA9IHN0YXJ0T2ZEYXkobmV3IERhdGUoMjAxNCwgOCwgMiwgMTEsIDU1LCAwKSlcbiAqIC8vPT4gVHVlIFNlcCAwMiAyMDE0IDAwOjAwOjAwXG4gKi9cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gc3RhcnRPZkRheShkaXJ0eURhdGUpIHtcbiAgcmVxdWlyZWRBcmdzKDEsIGFyZ3VtZW50cyk7XG4gIHZhciBkYXRlID0gdG9EYXRlKGRpcnR5RGF0ZSk7XG4gIGRhdGUuc2V0SG91cnMoMCwgMCwgMCwgMCk7XG4gIHJldHVybiBkYXRlO1xufSIsImltcG9ydCBzdGFydE9mRGF5IGZyb20gXCIuLi9zdGFydE9mRGF5L2luZGV4LmpzXCI7XG5pbXBvcnQgcmVxdWlyZWRBcmdzIGZyb20gXCIuLi9fbGliL3JlcXVpcmVkQXJncy9pbmRleC5qc1wiO1xuLyoqXG4gKiBAbmFtZSBpc1NhbWVEYXlcbiAqIEBjYXRlZ29yeSBEYXkgSGVscGVyc1xuICogQHN1bW1hcnkgQXJlIHRoZSBnaXZlbiBkYXRlcyBpbiB0aGUgc2FtZSBkYXkgKGFuZCB5ZWFyIGFuZCBtb250aCk/XG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBBcmUgdGhlIGdpdmVuIGRhdGVzIGluIHRoZSBzYW1lIGRheSAoYW5kIHllYXIgYW5kIG1vbnRoKT9cbiAqXG4gKiBAcGFyYW0ge0RhdGV8TnVtYmVyfSBkYXRlTGVmdCAtIHRoZSBmaXJzdCBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0ge0RhdGV8TnVtYmVyfSBkYXRlUmlnaHQgLSB0aGUgc2Vjb25kIGRhdGUgdG8gY2hlY2tcbiAqIEByZXR1cm5zIHtCb29sZWFufSB0aGUgZGF0ZXMgYXJlIGluIHRoZSBzYW1lIGRheSAoYW5kIHllYXIgYW5kIG1vbnRoKVxuICogQHRocm93cyB7VHlwZUVycm9yfSAyIGFyZ3VtZW50cyByZXF1aXJlZFxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBBcmUgNCBTZXB0ZW1iZXIgMDY6MDA6MDAgYW5kIDQgU2VwdGVtYmVyIDE4OjAwOjAwIGluIHRoZSBzYW1lIGRheT9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzU2FtZURheShuZXcgRGF0ZSgyMDE0LCA4LCA0LCA2LCAwKSwgbmV3IERhdGUoMjAxNCwgOCwgNCwgMTgsIDApKVxuICogLy89PiB0cnVlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFyZSA0IFNlcHRlbWJlciBhbmQgNCBPY3RvYmVyIGluIHRoZSBzYW1lIGRheT9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzU2FtZURheShuZXcgRGF0ZSgyMDE0LCA4LCA0KSwgbmV3IERhdGUoMjAxNCwgOSwgNCkpXG4gKiAvLz0+IGZhbHNlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFyZSA0IFNlcHRlbWJlciwgMjAxNCBhbmQgNCBTZXB0ZW1iZXIsIDIwMTUgaW4gdGhlIHNhbWUgZGF5P1xuICogY29uc3QgcmVzdWx0ID0gaXNTYW1lRGF5KG5ldyBEYXRlKDIwMTQsIDgsIDQpLCBuZXcgRGF0ZSgyMDE1LCA4LCA0KSlcbiAqIC8vPT4gZmFsc2VcbiAqL1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBpc1NhbWVEYXkoZGlydHlEYXRlTGVmdCwgZGlydHlEYXRlUmlnaHQpIHtcbiAgcmVxdWlyZWRBcmdzKDIsIGFyZ3VtZW50cyk7XG4gIHZhciBkYXRlTGVmdFN0YXJ0T2ZEYXkgPSBzdGFydE9mRGF5KGRpcnR5RGF0ZUxlZnQpO1xuICB2YXIgZGF0ZVJpZ2h0U3RhcnRPZkRheSA9IHN0YXJ0T2ZEYXkoZGlydHlEYXRlUmlnaHQpO1xuICByZXR1cm4gZGF0ZUxlZnRTdGFydE9mRGF5LmdldFRpbWUoKSA9PT0gZGF0ZVJpZ2h0U3RhcnRPZkRheS5nZXRUaW1lKCk7XG59IiwiaW1wb3J0IHsgbmV3VG9EbyB9IGZyb20gXCIuL2FkZFRvRG9cIjtcbmltcG9ydCB7IGFkZFRvTWFpbkZvbGRlciwgYWRkRm9sZGVyLCB9IGZyb20gXCIuL2ZvbGRlcnNcIjtcbmltcG9ydCB7IGRpc3BsYXlGb2xkZXJzLCBkaXNwbGF5U3dpdGNoRm9sZGVycyB9IGZyb20gXCIuL2Rpc3BsYXlGb2xkZXJzXCI7XG5pbXBvcnQgeyBjcmVhdGVGb2xkZXIsIGZvbGRlciB9IGZyb20gXCIuL2NyZWF0ZU5ld0ZvbGRlclwiO1xuaW1wb3J0IGlzVGhpc1dlZWsgZnJvbSBcImRhdGUtZm5zL2lzVGhpc1dlZWtcIjtcbmltcG9ydCB7IGlzVG9kYXkgfSBmcm9tIFwiZGF0ZS1mbnNcIjtcbmltcG9ydCB7IHNpZGVCYXJGb2xkZXJzIH0gZnJvbSBcIi4vZm9sZGVyc1wiO1xuXG5cblxuZXhwb3J0IGxldCBjdXJyZW50Zm9sZGVyID0gXCJcIlxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Rm9ybURhdGEoZm9ybSwgYnV0dG9uVHlwZSwgY3VycmVudEZvbGRlcikge1xuICAgIGxldCBrID0gZm9ybVxuICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShrKVxuICAgIGxldCBvYmplY3QgPSBPYmplY3QuZnJvbUVudHJpZXMoZm9ybURhdGEpXG4gICAgXG4gICAgbGV0IHRpdGxlID0gb2JqZWN0LnRpdGxlXG4gICAgbGV0IGRlc2NyaXB0aW9uID0gb2JqZWN0LmRlc2NyaXB0aW9uXG4gICAgbGV0IGR1ZURhdGUgPSBvYmplY3QuZHVlRGF0ZVxuICAgIGxldCBwcmlvcml0eSA9IG9iamVjdC5wcmlvcml0eVxuICAgIGlmIChidXR0b25UeXBlID09PSBcImVkaXRUYXNrXCIpIHtcbiAgICAgICAgbGV0IGZvbGRlciA9IGN1cnJlbnRGb2xkZXIucGFyZW50Rm9sZGVyO1xuICAgICAgICBjb25zb2xlLmxvZyhmb2xkZXIudG9Eb2ZvbGRlcikgIDtcbiAgICAgICAgY3VycmVudEZvbGRlci5lZGl0VG9Ebyh0aXRsZSwgZGVzY3JpcHRpb24sIGR1ZURhdGUsIHByaW9yaXR5KTtcbiAgICAgICAgZGlzcGxheVN3aXRjaEZvbGRlcnMoZm9sZGVyLnRvRG9mb2xkZXIpO1xuICAgIH0gZWxzZSBpZiAoYnV0dG9uVHlwZSA9PT0gXCJhZGRUYXNrXCIpIHtcbiAgICBhc3NpZ25Gb3JtRGF0YSh0aXRsZSwgZGVzY3JpcHRpb24sIGR1ZURhdGUsIHByaW9yaXR5LCBjdXJyZW50Rm9sZGVyKTtcbiAgICB9IGVsc2UgIHtcbiAgICAgICAgbmV3Rm9sZGVyKHRpdGxlKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGFzc2lnbkZvcm1EYXRhKHRpdGxlLCBkZXNjcmlwdGlvbiwgZHVlRGF0ZSwgcHJpb3JpdHksIGN1cnJlbnRGb2xkZXIpIHtcbiAgICBcblxuICAgIGxldCB0b0RvID0gbmV3IG5ld1RvRG8odGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVEYXRlLCBwcmlvcml0eSk7XG4gICAgZGV0ZXJtaW5lRGF0ZSh0b0RvKTtcbiAgICBhZGRUb01haW5Gb2xkZXIoKS5hZGQodG9Ebyk7XG4gICAgaWYgKGN1cnJlbnRGb2xkZXIgIT09IFwiXCIpIHtcbiAgICAgICAgY3VycmVudEZvbGRlci5hZGRUb0ZvbGRlcih0b0RvKTtcbiAgICAgICAgY3VycmVudEZvbGRlci5zd2l0Y2hNYWluRGlzcGxheUZvbGRlcigpO1xuICAgICAgICBcbiAgICB9IGVsc2Uge1xuICAgIGRpc3BsYXlGb2xkZXJzKHRvRG8pOyBcbiAgICB9XG59XG5cbmZ1bmN0aW9uIG5ld0ZvbGRlcih0aXRsZSkge1xuICAgIGxldCBuZXdGb2xkZXIgPSBuZXcgZm9sZGVyKHRpdGxlKTtcbiAgICBjdXJyZW50Zm9sZGVyID0gbmV3Rm9sZGVyO1xuICAgIG5ld0ZvbGRlci5uZXdGb2xkZXJEb20oKTtcbiAgICBuZXdGb2xkZXIuc3dpdGNoTWFpbkRpc3BsYXlGb2xkZXIoKTtcblxufVxuXG5mdW5jdGlvbiBkZXRlcm1pbmVEYXRlKHRvRG8pIHtcbiAgICBsZXQgcGFyc2VkRGF0ZSA9IERhdGUucGFyc2UodG9Eby5kdWVEYXRlKTtcbiAgICBsZXQgZm9sZGVyRGF0ZSA9IFwiXCJcblxuICAgIGlmIChpc1RoaXNXZWVrKHBhcnNlZERhdGUpKSB7XG4gICAgICAgIGZvbGRlckRhdGUgPSBcIndlZWtcIlxuICAgIH1cblxuICAgIGVsc2UgaWYgKGlzVG9kYXkocGFyc2VkRGF0ZSkpe1xuICAgICAgICBmb2xkZXJEYXRlID0gXCJ0b2RheVwiXG4gICAgfVxuXG4gICAgaWYgKGZvbGRlckRhdGUgPT09IFwid2Vla1wiKSB7XG4gICAgICAgIHNpZGVCYXJGb2xkZXJzLnB1c2hUb1dlZWsodG9Ebyk7XG4gICAgICAgIHRvRG8uYWRkRGF0ZUZvbGRlcihcIndlZWtcIik7XG5cbiAgICB9IGVsc2UgaWYgKGZvbGRlckRhdGUgPT09IFwidG9kYXlcIikge1xuICAgICAgICBzaWRlQmFyRm9sZGVycygpLnB1c2hUb1RvZGF5KHRvRG8pO1xuICAgICAgICB0b0RvLmFkZERhdGVGb2xkZXIoXCJ0b2RheVwiKTtcbiAgICB9XG5cbn1cblxuIiwiaW1wb3J0IGlzU2FtZVdlZWsgZnJvbSBcIi4uL2lzU2FtZVdlZWsvaW5kZXguanNcIjtcbmltcG9ydCByZXF1aXJlZEFyZ3MgZnJvbSBcIi4uL19saWIvcmVxdWlyZWRBcmdzL2luZGV4LmpzXCI7XG5cbi8qKlxuICogQG5hbWUgaXNUaGlzV2Vla1xuICogQGNhdGVnb3J5IFdlZWsgSGVscGVyc1xuICogQHN1bW1hcnkgSXMgdGhlIGdpdmVuIGRhdGUgaW4gdGhlIHNhbWUgd2VlayBhcyB0aGUgY3VycmVudCBkYXRlP1xuICogQHB1cmUgZmFsc2VcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIElzIHRoZSBnaXZlbiBkYXRlIGluIHRoZSBzYW1lIHdlZWsgYXMgdGhlIGN1cnJlbnQgZGF0ZT9cbiAqXG4gKiA+IOKaoO+4jyBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gaXMgbm90IHByZXNlbnQgaW4gdGhlIEZQIHN1Ym1vZHVsZSBhc1xuICogPiBpdCB1c2VzIGBEYXRlLm5vdygpYCBpbnRlcm5hbGx5IGhlbmNlIGltcHVyZSBhbmQgY2FuJ3QgYmUgc2FmZWx5IGN1cnJpZWQuXG4gKlxuICogQHBhcmFtIHtEYXRlfE51bWJlcn0gZGF0ZSAtIHRoZSBkYXRlIHRvIGNoZWNrXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIC0gdGhlIG9iamVjdCB3aXRoIG9wdGlvbnNcbiAqIEBwYXJhbSB7TG9jYWxlfSBbb3B0aW9ucy5sb2NhbGU9ZGVmYXVsdExvY2FsZV0gLSB0aGUgbG9jYWxlIG9iamVjdC4gU2VlIFtMb2NhbGVde0BsaW5rIGh0dHBzOi8vZGF0ZS1mbnMub3JnL2RvY3MvTG9jYWxlfVxuICogQHBhcmFtIHswfDF8MnwzfDR8NXw2fSBbb3B0aW9ucy53ZWVrU3RhcnRzT249MF0gLSB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGRheSBvZiB0aGUgd2VlayAoMCAtIFN1bmRheSlcbiAqIEByZXR1cm5zIHtCb29sZWFufSB0aGUgZGF0ZSBpcyBpbiB0aGlzIHdlZWtcbiAqIEB0aHJvd3Mge1R5cGVFcnJvcn0gMSBhcmd1bWVudCByZXF1aXJlZFxuICogQHRocm93cyB7UmFuZ2VFcnJvcn0gYG9wdGlvbnMud2Vla1N0YXJ0c09uYCBtdXN0IGJlIGJldHdlZW4gMCBhbmQgNlxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBJZiB0b2RheSBpcyAyNSBTZXB0ZW1iZXIgMjAxNCwgaXMgMjEgU2VwdGVtYmVyIDIwMTQgaW4gdGhpcyB3ZWVrP1xuICogY29uc3QgcmVzdWx0ID0gaXNUaGlzV2VlayhuZXcgRGF0ZSgyMDE0LCA4LCAyMSkpXG4gKiAvLz0+IHRydWVcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gSWYgdG9kYXkgaXMgMjUgU2VwdGVtYmVyIDIwMTQgYW5kIHdlZWsgc3RhcnRzIHdpdGggTW9uZGF5XG4gKiAvLyBpcyAyMSBTZXB0ZW1iZXIgMjAxNCBpbiB0aGlzIHdlZWs/XG4gKiBjb25zdCByZXN1bHQgPSBpc1RoaXNXZWVrKG5ldyBEYXRlKDIwMTQsIDgsIDIxKSwgeyB3ZWVrU3RhcnRzT246IDEgfSlcbiAqIC8vPT4gZmFsc2VcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gaXNUaGlzV2VlayhkaXJ0eURhdGUsIG9wdGlvbnMpIHtcbiAgcmVxdWlyZWRBcmdzKDEsIGFyZ3VtZW50cyk7XG4gIHJldHVybiBpc1NhbWVXZWVrKGRpcnR5RGF0ZSwgRGF0ZS5ub3coKSwgb3B0aW9ucyk7XG59IiwiaW1wb3J0IGlzU2FtZURheSBmcm9tIFwiLi4vaXNTYW1lRGF5L2luZGV4LmpzXCI7XG5pbXBvcnQgcmVxdWlyZWRBcmdzIGZyb20gXCIuLi9fbGliL3JlcXVpcmVkQXJncy9pbmRleC5qc1wiO1xuLyoqXG4gKiBAbmFtZSBpc1RvZGF5XG4gKiBAY2F0ZWdvcnkgRGF5IEhlbHBlcnNcbiAqIEBzdW1tYXJ5IElzIHRoZSBnaXZlbiBkYXRlIHRvZGF5P1xuICogQHB1cmUgZmFsc2VcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIElzIHRoZSBnaXZlbiBkYXRlIHRvZGF5P1xuICpcbiAqID4g4pqg77iPIFBsZWFzZSBub3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBpcyBub3QgcHJlc2VudCBpbiB0aGUgRlAgc3VibW9kdWxlIGFzXG4gKiA+IGl0IHVzZXMgYERhdGUubm93KClgIGludGVybmFsbHkgaGVuY2UgaW1wdXJlIGFuZCBjYW4ndCBiZSBzYWZlbHkgY3VycmllZC5cbiAqXG4gKiBAcGFyYW0ge0RhdGV8TnVtYmVyfSBkYXRlIC0gdGhlIGRhdGUgdG8gY2hlY2tcbiAqIEByZXR1cm5zIHtCb29sZWFufSB0aGUgZGF0ZSBpcyB0b2RheVxuICogQHRocm93cyB7VHlwZUVycm9yfSAxIGFyZ3VtZW50IHJlcXVpcmVkXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElmIHRvZGF5IGlzIDYgT2N0b2JlciAyMDE0LCBpcyA2IE9jdG9iZXIgMTQ6MDA6MDAgdG9kYXk/XG4gKiBjb25zdCByZXN1bHQgPSBpc1RvZGF5KG5ldyBEYXRlKDIwMTQsIDksIDYsIDE0LCAwKSlcbiAqIC8vPT4gdHJ1ZVxuICovXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGlzVG9kYXkoZGlydHlEYXRlKSB7XG4gIHJlcXVpcmVkQXJncygxLCBhcmd1bWVudHMpO1xuICByZXR1cm4gaXNTYW1lRGF5KGRpcnR5RGF0ZSwgRGF0ZS5ub3coKSk7XG59IiwiLyogZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUZvbGRlcihmb2xkZXIpIHtcbiAgICBjb25zdCBuZXdGb2xkZXIgPSBbIF1cbiAgICBuZXdGb2xkZXJEb20oZm9sZGVyKTtcbiAgICBcbiAgICByZXR1cm4gbmV3Rm9sZGVyXG4gICAgXG59XG5cbmZ1bmN0aW9uIG5ld0ZvbGRlckRvbShmb2xkZXIpIHtcbiAgICBjb25zdCBhcHBlbmRIZXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb2xkZXJzLWNvbnRhaW5lclwiKVxuICAgIGxldCBmb2xkZXJCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKVxuICAgIGZvbGRlckJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwibWVudS1saW5rLWl0ZW1cIilcbiAgICBmb2xkZXJCdXR0b24udGV4dENvbnRlbnQgPSBmb2xkZXJcbiAgICBhcHBlbmRIZXJlLmFwcGVuZENoaWxkKGZvbGRlckJ1dHRvbilcbn0gKi9cblxuaW1wb3J0IHsgZGlzcGxheVN3aXRjaEZvbGRlcnMgfSBmcm9tIFwiLi9kaXNwbGF5Rm9sZGVyc1wiXG5pbXBvcnQgeyBjdXJyZW50Zm9sZGVyIH0gZnJvbSBcIi4vZ2V0Rm9ybURhdGFcIlxuXG5leHBvcnQgY2xhc3MgZm9sZGVyIHtcbiAgICB0b0RvZm9sZGVyID0gW1xuXG4gICAgXVxuXG4gICAgY29uc3RydWN0b3IoZm9sZGVyKSB7XG4gICAgICAgIHRoaXMuZm9sZGVyID0gZm9sZGVyXG4gICAgfVxuICAgIFxuICAgIHNldEhlYWRlcigpIHtcbiAgICAgICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tYWluLXRpdGxlXCIpXG4gICAgICAgIGhlYWRlci50ZXh0Q29udGVudCA9IHRoaXMuZm9sZGVyO1xuICAgIH1cblxuICAgIG5ld0ZvbGRlckRvbShmb2xkZXIpIHtcbiAgICAgICAgdGhpcy5zZXRIZWFkZXIoKTtcbiAgICAgICAgdGhpcy5zd2l0Y2hNYWluRGlzcGxheUZvbGRlcih0aGlzLnRvRG9mb2xkZXIpO1xuICAgICAgICBjb25zdCBhcHBlbmRIZXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb2xkZXJzLWNvbnRhaW5lclwiKVxuICAgICAgICBsZXQgZm9sZGVyQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIilcbiAgICAgICAgZm9sZGVyQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJtZW51LWxpbmstaXRlbVwiKVxuICAgICAgICBmb2xkZXJCdXR0b24udGV4dENvbnRlbnQgPSB0aGlzLmZvbGRlcjtcbiAgICAgICAgYXBwZW5kSGVyZS5hcHBlbmRDaGlsZChmb2xkZXJCdXR0b24pXG4gICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzXG4gICAgICAgIGZvbGRlckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGF0LnN3aXRjaE1haW5EaXNwbGF5Rm9sZGVyKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFkZFRvRm9sZGVyKHRvRG8pIHtcbiAgICAgICAgdGhpcy50b0RvZm9sZGVyLnB1c2godG9EbylcbiAgICAgICAgY29uc29sZS5sb2codGhpcy50b0RvZm9sZGVyKTtcbiAgICAgICAgdG9Eby5hZGRQYXJlbnRGb2xkZXIodGhpcyk7XG4gICAgfVxuXG4gICAgZGVsZXRlRnJvbUZvbGRlcihpdGVtVG9EZWxldGUpIHtcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy50b0RvZm9sZGVyLmluZGV4T2YoaXRlbVRvRGVsZXRlKVxuICAgICAgICB0aGlzLnRvRG9mb2xkZXIuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG5cbiAgICBzd2l0Y2hNYWluRGlzcGxheUZvbGRlcigpIHtcbiAgICAgICAgY3VycmVudGZvbGRlciA9IHRoaXM7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMudG9Eb2ZvbGRlcik7XG4gICAgICAgIGRpc3BsYXlTd2l0Y2hGb2xkZXJzKHRoaXMudG9Eb2ZvbGRlcik7XG4gICAgICAgIHRoaXMuc2V0SGVhZGVyKCk7XG4gICAgfVxuXG4gICAgc3dpdGNoKCkge1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnRvRG9mb2xkZXIpO1xuICAgIH1cblxuICAgIHVwZGF0ZURpc3BsYXkoKSB7XG5cbiAgICB9XG5cbn1cbiIsIlxuaW1wb3J0IHsgZ2V0Rm9ybURhdGEgfSBmcm9tIFwiLi9nZXRGb3JtRGF0YVwiXG5cbmltcG9ydCB7IGN1cnJlbnRmb2xkZXIgfSBmcm9tIFwiLi9nZXRGb3JtRGF0YVwiXG5cbmNvbnN0IHBvcHVwSCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiRXBvcHVwXCIpXG5jb25zdCBwb3B1cE1haW4gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwicG9wdXAtbWFpblwiKVxuZXhwb3J0IGZ1bmN0aW9uIHBvcFVwKGUsIHRvRG8pIHtcbiAgICBsZXQgcG9wVXAgPSBldmVudC50YXJnZXQuaWRcbiAgICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBvcHVwLWhlYWRlclwiKVxuICAgIHBvcHVwSC5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCJcblxuXG4gICAgaWYgKGUgPT09IFwiaW5mb1wiKSB7XG4gICAgICAgIGhlYWRlci50ZXh0Q29udGVudCA9IFwiSW5mb1wiXG4gICAgICAgIGNyZWF0ZUluZm9Cb3hDb250ZW50cyh0b0RvKTtcbiAgICAgICAgY3JlYXRlQnV0dG9ucyhcImluZm9cIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGlmKGUgPT09IFwiZWRpdFwiKSB7XG4gICAgICAgIGhlYWRlci50ZXh0Q29udGVudCA9IFwiRWRpdFwiXG4gICAgICAgIGNyZWF0ZUJveElucHV0KFtcIlRpdGxlXCIsIFwiRGVzY3JpcHRpb25cIiwgXCJEdWUgRGF0ZVwiLCBcIlByaW9yaXR5XCJdLCBcImVkaXRcIiwgdG9Ebyk7XG4gICAgICAgIGNyZWF0ZUJ1dHRvbnMoXCJlZGl0VGFza1wiLCB0b0RvKVxuICAgIH1cblxuXG4gICAgaWYgKHBvcFVwID09IFwiY3JlYXRlRm9sZGVyXCIpIHtcbiAgICAgICAgaGVhZGVyLnRleHRDb250ZW50ID0gXCJDcmVhdGUgRm9sZGVyXCJcbiAgICAgICAgY3JlYXRlQm94SW5wdXQoW1wiVGl0bGVcIl0pXG4gICAgICAgIHBvcHVwTWFpblswXS5jbGFzc0xpc3QuYWRkKFwiY3JlYXRlRm9sZGVyXCIpO1xuICAgICAgICBjcmVhdGVCdXR0b25zKFwiY3JlYXRlRm9sZGVyXCIpO1xuICAgIH1cbiBcbiAgICBpZiAocG9wVXAgPT0gXCJhZGQtdGFza1wiKSB7XG4gICAgICAgIGhlYWRlci50ZXh0Q29udGVudCA9IFwiQWRkIHRhc2tcIlxuICAgICAgICBjcmVhdGVCb3hJbnB1dChbXCJUaXRsZVwiLCBcIkRlc2NyaXB0aW9uXCIsIFwiRHVlIERhdGVcIiwgXCJQcmlvcml0eVwiXSk7XG4gICAgICAgIGNyZWF0ZUJ1dHRvbnMoXCJhZGRUYXNrXCIpO1xuICAgIH1cbiAgICBcbn1cblxuZnVuY3Rpb24gY3JlYXRlQm94SW5wdXQoYXJyLCBlZGl0LCB0YXNrKSB7XG4gICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZm9ybVwiKVxuICAgIGxldCBhID0gdGFzaztcbiAgICBjb25zb2xlLmxvZyhhKTtcbiAgICBhcnIubWFwKGUgPT4ge1xuICAgICAgICBpZiAoZSA9PT0gXCJUaXRsZVwiKSB7XG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKVxuICAgICAgICAgICAgaWYgKGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gdGFzay50aXRsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBcInRpdGxlXCJcbiAgICAgICAgICAgIGlucHV0Lm5hbWUgPSBuYW1lXG4gICAgICAgICAgICBzZXRJbnB1dExhYmVsKGUsIGlucHV0LCBuYW1lKVxuICAgICAgICB9XG4gICAgICAgIGlmKGUgPT09IFwiRGVzY3JpcHRpb25cIikge1xuICAgICAgICAgICAgY29uc3QgdGV4dEFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGV4dGFyZWFcIilcbiAgICAgICAgICAgIGlmIChhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0ZXh0QXJlYS52YWx1ZSA9IHRhc2suZGVzY3JpcHRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0ZXh0QXJlYS5uYW1lID0gXCJkZXNjcmlwdGlvblwiXG4gICAgICAgICAgICBzZXRJbnB1dExhYmVsKGUsIHRleHRBcmVhKVxuICAgICAgICAgICAgXG5cbiAgICAgICAgfVxuICAgICAgICBpZihlID09PSBcIkR1ZSBEYXRlXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpXG4gICAgICAgICAgICBpZiAoYSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSB0YXNrLmR1ZURhdGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpbnB1dC5uYW1lID0gXCJkdWVEYXRlXCJcbiAgICAgICAgICAgIGlucHV0LnR5cGUgPSBcImRhdGVcIlxuICAgICAgICAgICAgc2V0SW5wdXRMYWJlbChlLCBpbnB1dClcblxuICAgICAgICB9XG4gICAgICAgIGlmKGUgPT09IFwiUHJpb3JpdHlcIikge1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlbGVjdFwiKVxuICAgICAgICAgICAgc2VsZWN0Lm5hbWUgPSBcInByaW9yaXR5XCI7XG4gICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVPcHRpb24gKHRleHRDb250ZW50KSB7XG4gICAgICAgICAgICAgICAgbGV0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIilcbiAgICAgICAgICAgICAgICBvcHRpb24udGV4dENvbnRlbnQgPSB0ZXh0Q29udGVudDtcbiAgICAgICAgICAgICAgICBzZWxlY3QuYXBwZW5kQ2hpbGQob3B0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNyZWF0ZU9wdGlvbihcIkxvd1wiKTtcbiAgICAgICAgICAgIGNyZWF0ZU9wdGlvbihcIkhpZ2hcIilcbiAgICAgICAgICAgIGlmIChhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBzZWxlY3QudmFsdWUgPSB0YXNrLnByaW9yaXR5ICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBzZXRJbnB1dExhYmVsKGUsIHNlbGVjdClcblxuICAgICAgICB9XG4gICAgfSlcbiAgLyogICBjb25zdCBpbnB1dExhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKVxuICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpXG4gICAgaW5wdXRXcmFwcGVyLmFwcGVuZENoaWxkKGlucHV0TGFiZWwpXG4gICAgaW5wdXRXcmFwcGVyLmFwcGVuZENoaWxkKGlucHV0KTsgKi9cblxuICAgIGZ1bmN0aW9uIHNldElucHV0TGFiZWwoZSwgZWxlbWVudFRvQ3JlYXRlLCBuYW1lKSB7XG4gICAgICAgIGNvbnN0IGlucHV0V3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgICAgICAgaW5wdXRXcmFwcGVyLmNsYXNzTGlzdC5hZGQoXCJpbnB1dC13cmFwcGVyXCIpXG4gICAgICAgIGZvcm0uYXBwZW5kQ2hpbGQoaW5wdXRXcmFwcGVyKTtcbiAgICAgICAgY29uc3QgaW5wdXRMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiKVxuICAgICAgICBpbnB1dExhYmVsLnRleHRDb250ZW50ID0gZVxuICAgICAgICBpbnB1dExhYmVsLmh0bWxGb3IgPSBuYW1lXG4gICAgICAgIGlucHV0V3JhcHBlci5hcHBlbmRDaGlsZChpbnB1dExhYmVsKVxuICAgICAgICBpbnB1dFdyYXBwZXIuYXBwZW5kQ2hpbGQoZWxlbWVudFRvQ3JlYXRlKVxuICAgICAgICBcbiAgICB9XG5cbn1cbmZ1bmN0aW9uIGNyZWF0ZUJ1dHRvbnMoYnV0dG9uVHlwZSwgdGFzaykge1xuXG4gICAgY29uc29sZS5sb2codGFzayk7XG5cbiAgICBcbiAgICBsZXQgc3VibWl0QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKVxuICAgIHN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU3VibWl0XCJcbiAgICBzdWJtaXRCdXR0b24uY2xhc3NMaXN0LmFkZChcInN1Ym1pdC1idXR0b25cIilcbiAgICBzdWJtaXRCdXR0b24udHlwZSA9IFwic3VibWl0XCJcblxuXG4gICAgc3VibWl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiBzdWJtaXQoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmIChidXR0b25UeXBlID09PSBcImFkZFRhc2tcIikge1xuICAgICAgICAgICAgZ2V0Rm9ybURhdGEoc3VibWl0QnV0dG9uLmZvcm0sIFwiYWRkVGFza1wiLCBjdXJyZW50Zm9sZGVyKVxuICAgICAgICB9IGVsc2UgaWYgKGJ1dHRvblR5cGUgPT09IFwiZWRpdFRhc2tcIikge1xuICAgICAgICAgICAgZ2V0Rm9ybURhdGEoc3VibWl0QnV0dG9uLmZvcm0sIFwiZWRpdFRhc2tcIiwgdGFzaylcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGdldEZvcm1EYXRhKHN1Ym1pdEJ1dHRvbi5mb3JtLCBcImNyZWF0ZUZvbGRlclwiKVxuICAgICAgICAgICAgcG9wdXBNYWluWzBdLmNsYXNzTGlzdC5yZW1vdmUoXCJjcmVhdGVGb2xkZXJcIik7XG4gICAgICAgIH1cbiAgICAgICAgICAgIGZvcm0uaW5uZXJIVE1MID0gXCIgXCJcbiAgICAgICAgICAgIHBvcHVwSC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCJcblxuICAgIH0pXG5cblxuICAgIGxldCBjYW5jZWxCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpXG4gICAgY2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiBwcmV2ZW50KGUsKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgbGV0IGluZm9Db250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmluZm8tY29udGFpbmVyXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhpbmZvQ29udGFpbmVyKTtcbiAgICAgICAgbGV0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImZvcm1cIilcbiAgICAgICAgICAgIGlmIChpbmZvQ29udGFpbmVyICE9PSB1bmRlZmluZWQgJiYgZm9ybS5zdHlsZS5kaXNwbGF5ID09PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmZvQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5pbmZvLWNvbnRhaW5lclwiKVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmb3JtXCIpXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGZvcm0pO1xuICAgICAgICAgICAgICAgICAgICBpbmZvQ29udGFpbmVyLmlubmVySFRNTCA9IFwiIFwiXG4gICAgICAgICAgICAgICAgICAgIGluZm9Db250YWluZXIucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIGZvcm0uc3R5bGUuZGlzcGxheSA9IFwiXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIGZvcm0uaW5uZXJIVE1MID0gXCIgXCJcbiAgICAgICAgcG9wdXBILnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIlxuICAgIH0gKVxuICAgIGNhbmNlbEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiQ2FuY2VsXCJcbiAgICBsZXQgYnV0dG9uc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgYnV0dG9uc0NvbnRhaW5lci5hcHBlbmRDaGlsZChzdWJtaXRCdXR0b24pO1xuICAgIGJ1dHRvbnNDb250YWluZXIuYXBwZW5kQ2hpbGQoY2FuY2VsQnV0dG9uKTtcbiAgICBidXR0b25zQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJidXR0b25zLWNvbnRhaW5lclwiKVxuICAgIGlmIChidXR0b25UeXBlID09PSBcImluZm9cIikge1xuICAgICAgICBjb25zdCBpbmZvQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5pbmZvLWNvbnRhaW5lclwiKVxuICAgICAgICBpbmZvQ29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbnNDb250YWluZXIpO1xuICAgICAgICBzdWJtaXRCdXR0b24ucmVtb3ZlKCk7XG4gICAgICAgIHJldHVyblxuICAgIH0gXG4gICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZm9ybVwiKVxuICAgIGZvcm0uYXBwZW5kQ2hpbGQoYnV0dG9uc0NvbnRhaW5lcik7XG5cbiAgICBcbn1cblxuXG5mdW5jdGlvbiBjcmVhdGVJbmZvQm94Q29udGVudHModG9Ebykge1xuICAgIGxldCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmb3JtXCIpO1xuICAgIGZvcm0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiXG4gICAgbGV0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJpbmZvLWNvbnRhaW5lclwiKTtcbiAgICBwb3B1cE1haW5bMF0uYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcblxuICAgIFxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChpbmZvQ29udGFpbmVyKFwiVGl0bGVcIiwgdG9Eby50aXRsZSkpO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChpbmZvQ29udGFpbmVyKFwiRGVzY3JpcHRpb25cIiwgdG9Eby5kZXNjcmlwdGlvbikpO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChpbmZvQ29udGFpbmVyKFwiRHVlIERhdGVcIiwgdG9Eby5kdWVEYXRlKSk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGluZm9Db250YWluZXIoXCJQcmlvcml0eVwiLCB0b0RvLnByaW9yaXR5KSk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGluZm9Db250YWluZXIoXCJGb2xkZXJcIiwgdG9Eby5wYXJlbnRGb2xkZXIuZm9sZGVyKSk7XG5cblxufVxuXG5cblxuZnVuY3Rpb24gaW5mb0NvbnRhaW5lcihsZWZ0LCByaWdodCkge1xuICAgIGxldCBpbmZvQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBpbmZvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJpbmZvLWl0ZW1cIik7XG4gICAgbGV0IGluZm9MZWZ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIilcbiAgICBsZXQgaW5mb1JpZ2h0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG5cblxuICAgIGluZm9MZWZ0LnRleHRDb250ZW50ID0gbGVmdDtcbiAgICBpbmZvUmlnaHQudGV4dENvbnRlbnQgPSByaWdodDtcbiAgICBpZiAobGVmdCA9PT0gXCJEZXNjcmlwdGlvblwiKSB7XG4gICAgICAgIGluZm9SaWdodC5jbGFzc0xpc3QuYWRkKFwiZGVzY1wiKVxuICAgICAgICBsZXQgZGVzY0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgICAgICAgZGVzY0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiZGVzYy1jb250YWluZXJcIik7XG4gICAgICAgIGRlc2NDb250YWluZXIuYXBwZW5kQ2hpbGQoaW5mb1JpZ2h0KTtcbiAgICAgICAgaW5mb0NvbnRhaW5lci5hcHBlbmRDaGlsZChpbmZvTGVmdCk7XG4gICAgICAgIGluZm9Db250YWluZXIuYXBwZW5kQ2hpbGQoZGVzY0NvbnRhaW5lcik7XG4gICAgICAgIHJldHVybiBpbmZvQ29udGFpbmVyO1xuICAgICAgICBcbiAgICB9IGVsc2UgXG4gICAgXG4gICAgaW5mb0NvbnRhaW5lci5hcHBlbmRDaGlsZChpbmZvTGVmdCk7XG4gICAgaW5mb0NvbnRhaW5lci5hcHBlbmRDaGlsZChpbmZvUmlnaHQpO1xuICAgIHJldHVybiBpbmZvQ29udGFpbmVyO1xuICAgIFxuXG59XG4iLCJpbXBvcnQgeyBmb2xkZXIgfSBmcm9tIFwiLi9jcmVhdGVOZXdGb2xkZXJcIlxuXG5pbXBvcnQgeyBwb3BVcCB9IGZyb20gXCIuL3BvcHVwXCJcblxuaW1wb3J0IHsgc2lkZUJhckZvbGRlcnMgfSBmcm9tIFwiLi9mb2xkZXJzXCJcblxuZXhwb3J0IGNsYXNzIG5ld1RvRG8ge1xuXG4gICAgY29uc3RydWN0b3IodGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVEYXRlLCBwcmlvcml0eSkge1xuICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGVcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uXG4gICAgICAgIHRoaXMuZHVlRGF0ZSA9IGR1ZURhdGVcbiAgICAgICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5XG4gICAgfVxuICAgIHN0b3JlSWNvbnMoc3Bhbikge1xuICAgICAgICBjb25zdCB0aGF0ID0gdGhpc1xuICAgICAgICBjb25zdCBhcnJheU9mSWNvbnMgPSBBcnJheS5mcm9tKHNwYW4pO1xuICAgICAgICBhcnJheU9mSWNvbnMuZm9yRWFjaChpY29uID0+IGljb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKXtcbiAgICAgICAgICAgIGxldCBpY29uID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICAgICAgICAgIGlmIChpY29uLmNsYXNzTGlzdC5jb250YWlucyhcInRyYXNoXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5kZWxldGUoKTtcbiAgICAgICAgICAgICAgICB0aGF0LmRlbGV0ZTIoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaWNvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJlZGl0XCIpKSB7XG4gICAgICAgICAgICAgICAgcG9wVXAoXCJlZGl0XCIsIHRoYXQpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwb3BVcChcImluZm9cIiwgdGhhdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKVxuICAgIH1cbiAgICBzdG9yZURvbUVsZW1lbnQodGFza0NvbnRhaW5lcikge1xuICAgICAgICB0aGlzLnRhc2tDb250YWluZXIgPSB0YXNrQ29udGFpbmVyO1xuXG4gICAgfVxuICAgIGRlbGV0ZSgpIHtcbiAgICAgICAgdGhpcy50YXNrQ29udGFpbmVyLnJlbW92ZSgpOyAgICBcblxuICAgIH1cblxuICAgIGRlbGV0ZTIoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMucGFyZW50Rm9sZGVyKTtcbiAgICAgICAgdGhpcy5wYXJlbnRGb2xkZXIuZGVsZXRlRnJvbUZvbGRlcih0aGlzKTtcbiAgICAgICAgaWYgKHRoaXMuZGF0ZUZvbGRlciA9PT0gXCJ3ZWVrXCIpIHtcbiAgICAgICAgICAgIHNpZGVCYXJGb2xkZXJzLnJlbW92ZVdlZWsodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhZGRQYXJlbnRGb2xkZXIoZSkge1xuICAgICAgICB0aGlzLnBhcmVudEZvbGRlciA9IGU7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMucGFyZW50Rm9sZGVyKTsgICBcbiAgICB9XG4gICAgXG4gICAgZWRpdFRvRG8odGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVEYXRlLCBwcmlvcml0eSkge1xuICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGVcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uXG4gICAgICAgIHRoaXMuZHVlRGF0ZSA9IGR1ZURhdGVcbiAgICAgICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5XG4gICAgfVxuICAgIFxuICAgIGFkZERhdGVGb2xkZXIoZm9sZGVyKSB7XG4gICAgICAgIHRoaXMuZGF0ZUZvbGRlciA9IGZvbGRlcjtcbiAgICB9XG5cbn0iLCJpbXBvcnQgeyBuZXdUb0RvIH0gZnJvbSBcIi4vYWRkVG9Eb1wiO1xuaW1wb3J0IHsgYWRkVG9NYWluRm9sZGVyIH0gZnJvbSBcIi4vZm9sZGVyc1wiO1xuaW1wb3J0IHsgY3JlYXRlRm9sZGVyIH0gZnJvbSBcIi4vY3JlYXRlTmV3Rm9sZGVyXCI7XG5pbXBvcnQgeyBwb3BVcCB9IGZyb20gXCIuL3BvcHVwXCI7XG5pbXBvcnQgeyBvayB9IGZyb20gXCIuL3NpZGViYXItbGlua3NcIjtcbmNvbnN0IGFkZFRhc2tCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFkZC10YXNrXCIpXG5hZGRUYXNrQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwb3BVcCk7XG5cbmNvbnN0IGNyZWF0ZUZvbGRlckJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY3JlYXRlRm9sZGVyXCIpO1xuY3JlYXRlRm9sZGVyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwb3BVcCk7XG5cbm9rKCk7XG5cblxuXG5cblxuLyogY2hlY2tGb3JFcnJvcnMob2spOyAqLyIsImltcG9ydCB7IHNpZGVCYXJGb2xkZXJzIH0gZnJvbSBcIi4vZm9sZGVyc1wiO1xuaW1wb3J0IHsgZGlzcGxheVN3aXRjaEZvbGRlcnMgfSBmcm9tIFwiLi9kaXNwbGF5Rm9sZGVyc1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gb2soKSB7Y29uc3Qgc2lkZUJhckxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tZW51LWxpbmstaXRlbVwiKVxuICAgIGNvbnNvbGUubG9nKFwidGVzdFwiKTtcbiAgICBzaWRlQmFyTGlua3MuZm9yRWFjaChhID0+IGEuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChhKSA9PiB7XG4gICAgICAgIGxldCBiID0gZXZlbnQudGFyZ2V0XG4gICAgYS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGlmIChiLnRleHRDb250ZW50ID09PSBcIldlZWtcIikge1xuICAgICAgICBsZXQgZm9sZGVyID0gc2lkZUJhckZvbGRlcnMuZ2V0V2VlaygpO1xuICAgICAgICBkaXNwbGF5U3dpdGNoRm9sZGVycyhmb2xkZXIpO1xuICAgIH1cbiAgICB9KSlcbn0iXSwibmFtZXMiOlsibWFpbkZvbGRlciIsInNpZGVCYXJGb2xkZXJzIiwid2VlayIsInRvZGF5IiwicHVzaFRvV2VlayIsInRvRG8iLCJ0aGlzIiwicHVzaCIsInB1c2hUb1RvZGF5IiwicHVzaHRvSW1wb3J0YW50IiwiaW1wb3J0YW50IiwiZ2V0V2VlayIsInJlbW92ZVdlZWsiLCJpdGVtIiwiaW5kZXgiLCJpbmRleE9mIiwic3BsaWNlIiwiZGlzcGxheVN3aXRjaEZvbGRlcnMiLCJmb2xkZXIiLCJjb25zb2xlIiwibG9nIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImUiLCJyZW1vdmUiLCJjcmVhdGVOZWVkZWRFbGVtZW50cyIsInRhc2tzQ29udGFpbmVyIiwicXVlcnlTZWxlY3RvciIsInRhc2tDb250YWluZXIiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwidGFza05hbWUiLCJhcHBlbmRDaGlsZCIsImlubmVySFRNTCIsInRpdGxlIiwiZGl2IiwiZGF0ZSIsImR1ZURhdGUiLCJzdG9yZURvbUVsZW1lbnQiLCJzcGFuIiwiYXJyYXlPZlNwYW5zIiwiaSIsImltZyIsImZpcnN0RWxlbWVudENoaWxkIiwic3JjIiwiY3JlYXRlSWNvbnMiLCJzdG9yZUljb25zIiwicmVxdWlyZWRBcmdzIiwicmVxdWlyZWQiLCJhcmdzIiwibGVuZ3RoIiwiVHlwZUVycm9yIiwiX3R5cGVvZiIsIm9iaiIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiY29uc3RydWN0b3IiLCJwcm90b3R5cGUiLCJ0b0RhdGUiLCJhcmd1bWVudCIsImFyZ3VtZW50cyIsImFyZ1N0ciIsIk9iamVjdCIsInRvU3RyaW5nIiwiY2FsbCIsIkRhdGUiLCJnZXRUaW1lIiwid2FybiIsIkVycm9yIiwic3RhY2siLCJOYU4iLCJ0b0ludGVnZXIiLCJkaXJ0eU51bWJlciIsIm51bWJlciIsIk51bWJlciIsImlzTmFOIiwiTWF0aCIsImNlaWwiLCJmbG9vciIsImRlZmF1bHRPcHRpb25zIiwiZ2V0RGVmYXVsdE9wdGlvbnMiLCJzdGFydE9mV2VlayIsImRpcnR5RGF0ZSIsIm9wdGlvbnMiLCJfcmVmIiwiX3JlZjIiLCJfcmVmMyIsIl9vcHRpb25zJHdlZWtTdGFydHNPbiIsIl9vcHRpb25zJGxvY2FsZSIsIl9vcHRpb25zJGxvY2FsZSRvcHRpbyIsIl9kZWZhdWx0T3B0aW9ucyRsb2NhbCIsIl9kZWZhdWx0T3B0aW9ucyRsb2NhbDIiLCJ3ZWVrU3RhcnRzT24iLCJsb2NhbGUiLCJSYW5nZUVycm9yIiwiZGF5IiwiZ2V0RGF5IiwiZGlmZiIsInNldERhdGUiLCJnZXREYXRlIiwic2V0SG91cnMiLCJpc1NhbWVXZWVrIiwiZGlydHlEYXRlTGVmdCIsImRpcnR5RGF0ZVJpZ2h0IiwiZGF0ZUxlZnRTdGFydE9mV2VlayIsImRhdGVSaWdodFN0YXJ0T2ZXZWVrIiwic3RhcnRPZkRheSIsImlzU2FtZURheSIsImRhdGVMZWZ0U3RhcnRPZkRheSIsImRhdGVSaWdodFN0YXJ0T2ZEYXkiLCJjdXJyZW50Zm9sZGVyIiwiZ2V0Rm9ybURhdGEiLCJmb3JtIiwiYnV0dG9uVHlwZSIsImN1cnJlbnRGb2xkZXIiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwib2JqZWN0IiwiZnJvbUVudHJpZXMiLCJkZXNjcmlwdGlvbiIsInByaW9yaXR5IiwicGFyZW50Rm9sZGVyIiwidG9Eb2ZvbGRlciIsImVkaXRUb0RvIiwibmV3VG9EbyIsIm9rIiwicGFyc2VkRGF0ZSIsInBhcnNlIiwiZm9sZGVyRGF0ZSIsIm5vdyIsImlzVGhpc1dlZWsiLCJpc1RvZGF5IiwiYWRkRGF0ZUZvbGRlciIsImRldGVybWluZURhdGUiLCJhZGRUb0ZvbGRlciIsInN3aXRjaE1haW5EaXNwbGF5Rm9sZGVyIiwiZGlzcGxheUZvbGRlcnMiLCJhc3NpZ25Gb3JtRGF0YSIsIm5ld0ZvbGRlciIsIm5ld0ZvbGRlckRvbSIsInNldEhlYWRlciIsInRleHRDb250ZW50IiwiYXBwZW5kSGVyZSIsImZvbGRlckJ1dHRvbiIsInRoYXQiLCJhZGRFdmVudExpc3RlbmVyIiwiYWRkUGFyZW50Rm9sZGVyIiwiZGVsZXRlRnJvbUZvbGRlciIsIml0ZW1Ub0RlbGV0ZSIsInN3aXRjaCIsInVwZGF0ZURpc3BsYXkiLCJwb3B1cEgiLCJnZXRFbGVtZW50QnlJZCIsInBvcHVwTWFpbiIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJwb3BVcCIsImV2ZW50IiwidGFyZ2V0IiwiaWQiLCJoZWFkZXIiLCJzdHlsZSIsImRpc3BsYXkiLCJjb250YWluZXIiLCJpbmZvQ29udGFpbmVyIiwiY3JlYXRlSW5mb0JveENvbnRlbnRzIiwiY3JlYXRlQnV0dG9ucyIsImNyZWF0ZUJveElucHV0IiwiYXJyIiwiZWRpdCIsInRhc2siLCJhIiwic2V0SW5wdXRMYWJlbCIsImVsZW1lbnRUb0NyZWF0ZSIsIm5hbWUiLCJpbnB1dFdyYXBwZXIiLCJpbnB1dExhYmVsIiwiaHRtbEZvciIsIm1hcCIsImlucHV0IiwidW5kZWZpbmVkIiwidmFsdWUiLCJ0ZXh0QXJlYSIsInR5cGUiLCJzZWxlY3QiLCJjcmVhdGVPcHRpb24iLCJvcHRpb24iLCJzdWJtaXRCdXR0b24iLCJwcmV2ZW50RGVmYXVsdCIsImNhbmNlbEJ1dHRvbiIsImJ1dHRvbnNDb250YWluZXIiLCJsZWZ0IiwicmlnaHQiLCJpbmZvTGVmdCIsImluZm9SaWdodCIsImRlc2NDb250YWluZXIiLCJBcnJheSIsImZyb20iLCJpY29uIiwiY3VycmVudFRhcmdldCIsImNvbnRhaW5zIiwiZGVsZXRlIiwiZGVsZXRlMiIsImRhdGVGb2xkZXIiLCJzaWRlQmFyTGlua3MiLCJiIl0sInNvdXJjZVJvb3QiOiIifQ==